---
import type { HTMLAttributes } from 'astro/types';

export type Props = HTMLAttributes<'canvas'> & {};

const { ...props } = Astro.props;
---

<canvas class:list={['js-img-sequence-canvas', props.class]} {...props}></canvas>

<script>
    import { ImgSequence } from '@chipsa-ui/core';

    Array.from(document.querySelectorAll('canvas.js-img-sequence-canvas')).forEach((canvas) => {
        const imgSequence = new ImgSequence({
            canvas: canvas as HTMLCanvasElement,
            loader: {
                strategy: 'instant',
                framesCount: 354,
                getFrameUrl: (idx) => `/img/sequence/image-${(idx + 1).toString().padStart(3, '0')}.webp`,
                onReady() {
                    imgSequence.render({ fallbackToClosestFrame: true });
                    imgSequence.play();
                },
            },
            playback: {
                fps: 60,
                loop: true,
            },
            render: {
                objectFit: 'contain',
                objectPosition: ['center', 'center'],
            },
        });
    });
</script>
